<div class="new-scan">
  <!-- Header -->
  <div class="scan-header">
    <!-- Return button doesn't seem to be necessary right now -->
    <!-- <button class="back-btn" (click)="goBack()">
      <span class="icon">←</span>
      Volver
    </button> -->
    <h1 class="scan-title">Nuevo Escaneo</h1>
    <p class="scan-subtitle">Configura y ejecuta un análisis de vulnerabilidades</p>
  </div>

  <!-- Scan Form -->
  <div class="scan-form-container">
    <form [formGroup]="scanForm" (ngSubmit)="onSubmit()" class="scan-form">
      
      <!-- Alias Input Section -->
      <div class="form-section">
        <h3 class="section-title">Información del Escaneo</h3>
        <div class="form-group">
          <label for="alias">Nombre del escaneo (alias)</label>
          <input 
            type="text" 
            id="alias"
            formControlName="alias"
            placeholder="Ej: Prueba Login - Producción"
            class="text-input"
          >
          <div class="error-message" *ngIf="scanForm.get('alias')?.invalid && scanForm.get('alias')?.touched">
            El nombre del escaneo es obligatorio
          </div>
        </div>
      </div>

      <!-- URL Input Section -->
      <div class="form-section">
        <h3 class="section-title">URL del Sitio Web</h3>
        <div class="form-group">
          <label for="url">URL a escanear</label>
          <div class="url-input-container">
            <input 
              type="url" 
              id="url"
              formControlName="url"
              placeholder="https://ejemplo.com"
              class="url-input"
            >
            <div class="url-icon"><fa-icon [icon]="faGlobe"></fa-icon></div>
          </div>
          <div class="error-message" *ngIf="scanForm.get('url')?.invalid && scanForm.get('url')?.touched">
            {{ getUrlErrorMessage() }}
          </div>
        </div>
      </div>

      <!-- Scan Type Selection -->
      <div class="form-section">
        <h3 class="section-title">Tipo de Escaneo</h3>
        <div class="scan-types">
          <div 
            *ngFor="let scanType of scanTypes" 
            class="scan-type-card"
            [class.selected]="selectedScanType === scanType.id"
            (click)="selectScanType(scanType.id)"
          >
            <div class="scan-type-icon" [style.background-color]="scanType.color">
              <fa-icon [icon]="getScanTypeIcon(scanType)"></fa-icon>
            </div>
            <div class="scan-type-content">
              <h4 class="scan-type-name">{{ scanType.name }}</h4>
              <p class="scan-type-description">{{ scanType.description }}</p>
            </div>
            <div class="scan-type-radio">
              <input 
                type="radio" 
                [value]="scanType.id" 
                formControlName="scanType"
                [checked]="selectedScanType === scanType.id"
              >
            </div>
          </div>
        </div>
      </div>

      <!-- DBMS Selection (only for SQLi scans) -->
      <div class="form-section" *ngIf="selectedScanType === 'sql' || selectedScanType === 'both'">
        <h3 class="section-title">Sistema Gestor de Base de Datos</h3>
        <div class="form-group">
          <label for="dbms">DBMS del objetivo</label>
          <select 
            id="dbms"
            formControlName="dbms"
            class="dbms-select"
            (change)="selectDbms($any($event.target).value)"
          >
            <option *ngFor="let dbms of dbmsList" [value]="dbms.id">
              {{ dbms.name }} - {{ dbms.description }}
            </option>
          </select>
          <small class="form-help">
            Selecciona el sistema de base de datos del sitio objetivo para mejorar la precisión del escaneo
          </small>
        </div>
      </div>

      <!-- Advanced Options -->
      <div class="form-section">
        <h3 class="section-title">Opciones Avanzadas</h3>
        <div class="form-group">
          <label for="customHeaders">Headers Personalizados (Opcional)</label>
          <textarea 
            id="customHeaders"
            formControlName="customHeaders"
            placeholder="Authorization: Bearer token&#10;X-Custom-Header: value"
            class="headers-textarea"
            rows="4"
          ></textarea>
          <small class="form-help">
            Formato: Un header por línea, separando clave y valor con ": "
          </small>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="submitError" class="submit-error">
        {{ submitError }}
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn--primary btn--large"
          [disabled]="scanForm.invalid || isSubmitting"
        >
          <span *ngIf="isSubmitting" class="loading-spinner"></span>
          {{ isSubmitting ? 'Iniciando escaneo...' : 'Iniciar Escaneo' }}
        </button>
      </div>
    </form>
  </div>
</div>
