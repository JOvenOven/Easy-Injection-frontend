<div class="scan-progress">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="main-header">
      <h1 class="scan-title">{{ scanName }}</h1>
      <div class="scan-info">
        <span class="scan-url">{{ scanUrl }}</span>
        <span class="scan-types">Escaneo de XSS y SQLI</span>
      </div>
    </div>
    <div class="scan-controls">
      <button class="btn btn--scanning" [disabled]="!isScanning">
        <span class="spinner" *ngIf="isScanning"></span>
        {{ isScanning ? 'Escaneando...' : 'Escaneo' }}
      </button>
      <button class="btn btn--pause" (click)="pauseScan()" [disabled]="!isScanning">
        {{ isPaused ? 'Reanudar' : 'Pausar' }}
      </button>
      <button class="btn btn--stop" (click)="stopScan()" [disabled]="!isScanning">
        Detener
      </button>
    </div>
  </div>

  <!-- Evaluation Questions Banner -->
  <div class="evaluation-banner" *ngIf="showEvaluationQuestions">
    <div class="banner-content">
      <h3>Preguntas de evaluaci√≥n requeridas</h3>
      <p>Para continuar con el escaneo, debes responder correctamente a las {{ totalQuestions }} preguntas de evaluaci√≥n. Has respondido correctamente a {{ questionsAnswered }} de {{ totalQuestions }} preguntas.</p>
    </div>
  </div>

  <!-- General Progress -->
  <div class="progress-section">
    <h3>Progreso general</h3>
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="overallProgress"></div>
    </div>
    <span class="progress-text">{{ overallProgress }}%</span>
  </div>

  <!-- Main Content Grid -->
  <div class="content-grid">
    <!-- Left Column -->
    <div class="left-column">
      <!-- Scan Phases -->
      <div class="phases-section">
        <h3>Fases del escaneo</h3>
        <div class="phases-list">
          <div 
            *ngFor="let phase of scanPhases; let i = index" 
            class="phase-item"
            [class.completed]="phase.status === 'completed'"
            [class.running]="phase.status === 'running'"
          >
            <div class="phase-icon">
              <span *ngIf="phase.status === 'completed'">‚úì</span>
              <span *ngIf="phase.status === 'running'">C</span>
              <span *ngIf="phase.status === 'pending'">‚è≥</span>
            </div>
            <div class="phase-content">
              <div class="phase-name">{{ phase.name }}</div>
              <div class="phase-progress" *ngIf="phase.status === 'running'">
                <div class="phase-progress-bar">
                  <div class="phase-progress-fill" [style.width.%]="phase.progress"></div>
                </div>
                <span class="phase-progress-text">{{ roundProgress(phase.progress) }}%</span>
              </div>
              <div class="phase-time" *ngIf="phase.startTime">
                Iniciado: {{ formatTime(phase.startTime) }}
                <span *ngIf="phase.endTime"> - Finalizado: {{ formatTime(phase.endTime) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Discovered Endpoints -->
      <div class="endpoints-section">
        <h3>Endpoints descubiertos</h3>
        <div class="endpoints-list">
          <div 
            *ngFor="let endpoint of discoveredEndpoints" 
            class="endpoint-item"
            [class]="getStatusClass(endpoint.status)"
          >
            <div class="endpoint-info">
              <span class="endpoint-path">{{ endpoint.path }}</span>
              <span class="endpoint-method">{{ endpoint.method }}</span>
            </div>
            <div class="endpoint-status">
              {{ getStatusLabel(endpoint.status) }}
            </div>
          </div>
        </div>
        <div class="endpoints-summary">
          {{ discoveredEndpoints.length }} de {{ totalEndpoints }} endpoints analizados
        </div>
      </div>

      <!-- Evaluation Question -->
      <div class="question-section" *ngIf="showEvaluationQuestions">
        <div class="question-card">
          <h4>Pregunta {{ currentQuestionIndex + 1 }} de {{ totalQuestions }}</h4>
          <p class="question-text">{{ evaluationQuestions[currentQuestionIndex].question }}</p>
          <div class="question-options">
            <label 
              *ngFor="let option of evaluationQuestions[currentQuestionIndex].options; let i = index"
              class="option-item"
              [class.selected]="evaluationQuestions[currentQuestionIndex].userAnswer === i"
            >
              <input 
                type="radio" 
                [name]="'question' + evaluationQuestions[currentQuestionIndex].id"
                [value]="i"
                (change)="selectAnswer(evaluationQuestions[currentQuestionIndex].id, i)"
                [disabled]="evaluationQuestions[currentQuestionIndex].isAnswered"
              >
              <span class="option-text">{{ option }}</span>
            </label>
          </div>
          <div class="question-actions">
            <button 
              class="btn btn--verify" 
              (click)="verifyAnswer(evaluationQuestions[currentQuestionIndex].id)"
              [disabled]="evaluationQuestions[currentQuestionIndex].userAnswer === undefined"
            >
              Verificar respuesta
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <!-- Scan Logs -->
      <div class="logs-section">
        <h3>Logs del escaneo</h3>
        <div class="logs-container">
          <div 
            *ngFor="let log of scanLogs" 
            class="log-item"
            [class]="'log-' + log.type"
          >
            <span class="log-time">{{ formatTime(log.timestamp) }}</span>
            <span class="log-message">{{ log.message }}</span>
            <span class="log-icon" *ngIf="log.type === 'success'">‚úì</span>
          </div>
        </div>
      </div>

      <!-- Detected Vulnerabilities -->
      <div class="vulnerabilities-section">
        <h3>Vulnerabilidades detectadas</h3>
        <div class="vulnerabilities-list">
          <div 
            *ngFor="let vuln of detectedVulnerabilities" 
            class="vulnerability-item"
            [class]="getSeverityClass(vuln.severity)"
          >
            <div class="vuln-header">
              <span class="vuln-type">{{ vuln.type }}</span>
              <span class="vuln-severity">{{ getSeverityLabel(vuln.severity) }}</span>
            </div>
            <div class="vuln-details">
              <div class="vuln-endpoint">Endpoint: {{ vuln.endpoint }}</div>
              <div class="vuln-parameter">Par√°metro: {{ vuln.parameter }}</div>
              <div class="vuln-time">Detectado: {{ formatTime(vuln.detectedAt) }}</div>
            </div>
          </div>
        </div>
        <button class="btn btn--view-all" *ngIf="detectedVulnerabilities.length > 0">
          Ver todas las vulnerabilidades
        </button>
      </div>

      <!-- Statistics -->
      <div class="stats-section">
        <h3>Estad√≠sticas</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value">{{ scanStats.endpoints }}</span>
            <span class="stat-label">Endpoints</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ scanStats.parameters }}</span>
            <span class="stat-label">Par√°metros</span>
          </div>
          <div class="stat-item" *ngIf="scanStats.xssFound > 0">
            <span class="stat-value xss">{{ scanStats.xssFound }}</span>
            <span class="stat-label">XSS</span>
          </div>
          <div class="stat-item" *ngIf="scanStats.sqliFound > 0">
            <span class="stat-value sqli">{{ scanStats.sqliFound }}</span>
            <span class="stat-label">SQLI</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Button (appears when scan is complete) -->
  <div class="results-button-container" *ngIf="scanComplete">
    <button class="btn btn--results" (click)="showResults()">
      üìä Ver Resultados Completos
    </button>
  </div>

  <!-- Results Modal -->
  <div class="modal-overlay" *ngIf="showResultsModal" (click)="closeResults()">
    <div class="modal-content results-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Resultados del Escaneo</h3>
        <button class="modal-close" (click)="closeResults()">&times;</button>
      </div>
      
      <div class="modal-body">
        <!-- Detailed results content will go here -->
        <div class="results-summary">
          <h4>Resumen de Vulnerabilidades</h4>
          <div class="vuln-summary">
            <div class="vuln-type-summary">
              <h5>XSS (Cross-Site Scripting)</h5>
              <p>{{ scanStats.xssFound }} vulnerabilidades encontradas</p>
            </div>
            <div class="vuln-type-summary">
              <h5>SQL Injection</h5>
              <p>{{ scanStats.sqliFound }} vulnerabilidades encontradas</p>
            </div>
          </div>
        </div>

        <div class="detailed-vulnerabilities">
          <h4>Vulnerabilidades Detalladas</h4>
          <div class="vuln-list">
            <div 
              *ngFor="let vuln of detectedVulnerabilities" 
              class="vuln-detail-item"
              [class]="getSeverityClass(vuln.severity)"
            >
              <div class="vuln-detail-header">
                <span class="vuln-id">{{ vuln.id }}</span>
                <span class="vuln-severity-badge">{{ getSeverityLabel(vuln.severity) }}</span>
              </div>
              <div class="vuln-detail-content">
                <p><strong>Tipo:</strong> {{ vuln.type }}</p>
                <p><strong>Endpoint:</strong> {{ vuln.endpoint }}</p>
                <p><strong>Par√°metro:</strong> {{ vuln.parameter }}</p>
                <p><strong>Descripci√≥n:</strong> {{ vuln.description }}</p>
                <p><strong>Detectado:</strong> {{ formatTime(vuln.detectedAt) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn--outline" (click)="downloadReport()">
          üìÑ Descargar Reporte
        </button>
        <button class="btn btn--primary" (click)="goToScans()">
          üìã Ver Todos los Escaneos
        </button>
      </div>
    </div>
  </div>
</div>