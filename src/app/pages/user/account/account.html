<div class="account">
    <h1 class="account-title">Mi cuenta</h1>
    <p class="account-subtitle">
      Gestiona tu informaciÃ³n de cuenta y preferencias de seguridad
    </p>

    <!-- Notification Display -->
    <div *ngIf="showNotification" 
         class="notification" 
         [ngClass]="notificationType === 'error' ? 'submit-error' : 'submit-success'">
      <span>{{ notificationMessage }}</span>
      <button class="notification-close" (click)="hideNotification()">&times;</button>
    </div>
  
    <div class="account-container">
      <!-- MenÃº lateral -->
      <aside class="account-sidebar">
        <ul>
          <li class="active">
            <span class="icon">ğŸ‘¤</span> InformaciÃ³n
          </li>
          <li>
            <span class="icon">ğŸ”’</span> Seguridad
          </li>
          <li>
            <span class="icon">â“</span> Ayuda
          </li>
        </ul>
        <button class="btn-logout">Cerrar sesiÃ³n</button>
      </aside>
  
      <!-- Panel principal -->
      <div class="account-content">
        <!-- InformaciÃ³n personal -->
        <div class="card">
          <div class="card-header">
            <h3>Perfil</h3>
            <button class="btn-outline" (click)="openEditProfileModal()">Editar perfil</button>
          </div>
          <div class="profile-info">
            <img [src]="getAvatarPath(user.perfil?.avatarId || 'avatar1')" alt="Avatar" class="avatar" />
            <div>
              <p><strong>Nombre de usuario:</strong> {{ user.username }}</p>
              <p><strong>Correo electrÃ³nico:</strong> {{ user.email }}</p>
              <p><strong>Ãšltimo inicio de sesiÃ³n:</strong> {{ user.ultimo_login }}</p>
              <p><strong>Cuenta creada el:</strong> {{ user.fecha_registro }}</p>
            </div>
          </div>
        </div>
  
        <!-- Seguridad -->
        <div class="card">
          <div class="card-header">
            <h3>Seguridad</h3>
            <button class="btn-outline" (click)="openChangePasswordModal()">Cambiar contraseÃ±a</button>
          </div>
          <p>Cambia tu contraseÃ±a regularmente para mayor seguridad</p>
        </div>
  
        <!-- Sesiones activas -->
        <div class="card">
          <h3>Sesiones activas</h3>
          <p class="text-muted">Dispositivos donde tu cuenta estÃ¡ actualmente iniciada</p>
          <div class="session-item" *ngFor="let session of sessions">
            <span class="icon">ğŸ“±</span>
            <div>
              <p><strong>{{ session.device }}</strong></p>
              <p>{{ session.browser }} - {{ session.location }}</p>
            </div>
            <span class="status" [class.active]="session.isCurrent">{{ session.lastActive }}</span>
          </div>
          <button class="btn-outline full" (click)="closeAllSessions()">Cerrar todas las sesiones</button>
        </div>
      </div>
    </div>

    <!-- Password Change Modal -->
    <div class="modal-overlay" *ngIf="showPasswordModal" (click)="closeChangePasswordModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Cambiar contraseÃ±a</h3>
          <button class="modal-close" (click)="closeChangePasswordModal()">&times;</button>
        </div>
        
        <div class="modal-body">
          <p class="modal-description">
            Crea una nueva contraseÃ±a segura que no uses en otros sitios
          </p>

          <!-- Password Change Notification -->
          <div *ngIf="showChangePasswordMessage" 
               class="modal-notification" 
               [ngClass]="changePasswordMessageType === 'error' ? 'submit-error' : 'submit-success'">
            <span>{{ changePasswordMessage }}</span>
            <button class="notification-close" (click)="hideChangePasswordNotification()">&times;</button>
          </div>
          
          <form [formGroup]="changePasswordForm" (ngSubmit)="changePassword()">
            <div class="form-group">
              <label for="currentPassword">ContraseÃ±a actual</label>
              <div class="password-input">
                <input 
                  [type]="showCurrentPassword ? 'text' : 'password'" 
                  id="currentPassword"
                  formControlName="currentPassword"
                  placeholder="Ingresa tu contraseÃ±a actual"
                >
                <!-- <button type="button" class="password-toggle" (click)="togglePasswordVisibility('current')">
                  {{ showCurrentPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                </button> -->
              </div>
              <div class="error-message" *ngIf="changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched">
                La contraseÃ±a actual es requerida
              </div>
            </div>

            <div class="form-group">
              <label for="newPassword">Nueva contraseÃ±a</label>
              <div class="password-input">
                <input 
                  [type]="showNewPassword ? 'text' : 'password'" 
                  id="newPassword"
                  formControlName="newPassword"
                  placeholder="Ingresa tu nueva contraseÃ±a"
                >
                <!-- <button type="button" class="password-toggle" (click)="togglePasswordVisibility('new')">
                  {{ showNewPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                </button> -->
              </div>
              <div class="error-message" *ngIf="changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched">
                <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['required']">La nueva contraseÃ±a es requerida</div>
                <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['minlength']">La contraseÃ±a debe tener al menos 8 caracteres</div>
                <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['pattern']">La contraseÃ±a debe contener al menos una mayÃºscula, una minÃºscula y un nÃºmero</div>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirmar nueva contraseÃ±a</label>
              <div class="password-input">
                <input 
                  [type]="showConfirmPassword ? 'text' : 'password'" 
                  id="confirmPassword"
                  formControlName="confirmNewPassword"
                  placeholder="Confirma tu nueva contraseÃ±a"
                >
                <!-- <button type="button" class="password-toggle" (click)="togglePasswordVisibility('confirm')">
                  {{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                </button> -->
              </div>
              <div class="error-message" *ngIf="changePasswordForm.get('confirmNewPassword')?.invalid && changePasswordForm.get('confirmNewPassword')?.touched">
                <div *ngIf="changePasswordForm.get('confirmNewPassword')?.errors?.['required']">Confirma tu nueva contraseÃ±a</div>
              </div>
              <div class="error-message" *ngIf="changePasswordForm.errors?.['passwordMismatch'] && changePasswordForm.touched">
                Las contraseÃ±as no coinciden
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-cancel" (click)="closeChangePasswordModal()">
                Cancelar
              </button>
              <button type="submit" class="btn-save" [disabled]="changePasswordForm.invalid || changingPassword">
                <span *ngIf="changingPassword">Guardando...</span>
                <span *ngIf="!changingPassword">Guardar cambios</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" *ngIf="showEditProfileModal" (click)="closeEditProfileModal()">
      <div class="modal-content edit-profile-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Editar perfil</h3>
          <button class="modal-close" (click)="closeEditProfileModal()">&times;</button>
        </div>
        
        <div class="modal-body">
          <p class="modal-description">
            Actualiza tu informaciÃ³n de perfil
          </p>

          <!-- Edit Profile Notification -->
          <div *ngIf="showEditProfileMessage" 
               class="modal-notification" 
               [ngClass]="editProfileMessageType === 'error' ? 'submit-error' : 'submit-success'">
            <span>{{ editProfileMessage }}</span>
            <button class="notification-close" (click)="hideEditProfileNotification()">&times;</button>
          </div>
          
          <form [formGroup]="editForm" (ngSubmit)="saveProfile()">
            <!-- Tabs -->
            <div class="profile-tabs">
              <button type="button" 
                      class="tab-button" 
                      [class.active]="activeEditTab === 'username'"
                      (click)="setActiveEditTab('username')">
                Nombre de usuario
              </button>
              <button type="button" 
                      class="tab-button" 
                      [class.active]="activeEditTab === 'avatar'"
                      (click)="setActiveEditTab('avatar')">
                Avatar
              </button>
            </div>

            <!-- Username Tab Content -->
            <div class="tab-content" *ngIf="activeEditTab === 'username'">
              <div class="form-group">
                <label for="username">Nombre de usuario</label>
                <input 
                  type="text" 
                  id="username"
                  formControlName="username"
                  placeholder="Ingresa tu nombre de usuario"
                  class="username-input"
                >
                <div class="error-message" *ngIf="editForm.get('username')?.invalid && editForm.get('username')?.touched">
                  {{ getUsernameErrorMessage() }}
                </div>
              </div>

              <div class="username-requirements">
                <h4>Requisitos del nombre de usuario:</h4>
                <ul>
                  <li>Debe tener entre 3 y 20 caracteres</li>
                  <li>Solo puede contener letras, nÃºmeros y guiones bajos</li>
                  <li>No puede contener espacios ni caracteres especiales</li>
                  <li>Debe ser Ãºnico</li>
                </ul>
              </div>
            </div>

            <!-- Avatar Tab Content -->
            <div class="tab-content" *ngIf="activeEditTab === 'avatar'">
              <div class="current-avatar-section">
                <h4>Avatar actual</h4>
                <div class="current-avatar-display">
                  <img [src]="getAvatarPath(selectedAvatar) || 'avatar1.png'" alt="Avatar actual" class="current-avatar-image">
                  <p class="avatar-name">{{ getAvatarName(selectedAvatar) }}</p>
                </div>
              </div>

              <div class="avatar-gallery">
                <h4>Selecciona un avatar de la galerÃ­a</h4>
                <div class="avatar-grid">
                  <div class="avatar-option" 
                       *ngFor="let avatar of availableAvatars" 
                       [class.selected]="selectedAvatar === avatar.id"
                       (click)="selectAvatar(avatar.id)">
                    <img [src]="avatar.path" [alt]="avatar.name" class="avatar-thumbnail">
                    <div class="avatar-checkmark" *ngIf="selectedAvatar === avatar.id">âœ“</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-cancel" (click)="closeEditProfileModal()">
                Cancelar
              </button>
              <button type="submit" class="btn-save" [disabled]="editForm.invalid || saving">
                {{ saving ? 'Guardando...' : 'Guardar cambios' }}
              </button>              
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  